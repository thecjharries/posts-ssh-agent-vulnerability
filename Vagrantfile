# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
    config.vm.box = "fedora/27-cloud-base"

    config.vm.provision "shell" do |shell|
        shell.privileged = true
        shell.inline = <<-SHELL
        sed -i \
            -e 's/PermitRootLogin/#PermitRootLogin/g' \
            -e 's/#MaxAuthTries 6/MaxAuthTries 3/g' \
            -e 's/PasswordAuthentication yes/PasswordAuthentication no/g' \
            /etc/ssh/sshd_config
        systemctl restart sshd
        SHELL
    end

    config.vm.network "private_network", type: "dhcp"

    config.vm.define "ceres" do |ceres|
        ceres.vm.hostname = "ceres"

        ceres.vm.provision "shell" do |shell|
            shell.privileged = true
            shell.inline = <<-SHELL
            useradd -G wheel miller
            echo belter | passwd miller --stdin
            mkdir -p /home/miller/.ssh
            chmod 'u=rwx,go=' /home/miller/.ssh
            cp /vagrant/keys/miller* /home/miller/.ssh/
            chown -R miller:miller /home/miller/.ssh
            useradd service
            echo some_pass | passwd service --stdin
            mkdir -p /home/service/.ssh
            chmod 'u=rwx,go=' /home/service/.ssh
            cp /vagrant/keys/holden.pub /home/service/.ssh/authorized_keys
            chmod 'u=rw,go=' /home/service/.ssh/authorized_keys
            chown -R service:service /home/service/.ssh
            SHELL
        end
    end


end
